<!DOCTYPE html>
<html lang="pt-br">
<meta charset="UTF-8">
<title>Assis | Jesse James Pub</title>
<meta name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
<link rel="icon" type="image/png" href="icon.png"/>

<meta name="description" content="O melhor pub sertanejo do interior paulista">
<meta name="image" content="https://jessejamespub.com.br/dist/img/meta.png">

<meta itemprop="name" content="Jesse James Pub">
<meta itemprop="description" content="O melhor pub sertanejo do interior paulista">
<meta itemprop="image" content="https://jessejamespub.com.br/dist/img/meta.png">

<meta name="og:title" content="Jesse James Pub">
<meta name="og:description" content="O melhor pub sertanejo do interior paulista">
<meta name="og:image" content="https://jessejamespub.com.br/dist/img/meta.png">
<meta name="og:url" content="https://jessejamespub.com.br">
<meta name="og:site_name" content="Jesse James Pub">
<meta name="og:locale" content="pt_BR">
<meta name="fb:app_id" content="1586666258259861">
<meta name="og:type" content="website">

<script src="dist/js/villa.min.js"></script>
<link href="https://fonts.googleapis.com/css?family=Rye|Noto+Serif|Roboto+Condensed:400,700" rel="stylesheet">
<link rel="stylesheet" href="dist/css/villa.min.css"/>
<link rel="stylesheet" href="dist/css/jessejamespub.css"/>
<!--[if lt IE 9]>
<link rel="stylesheet" type="text/css" href="dist/css/material-colors.css"/>
<link rel="stylesheet" type="text/css" href="dist/css/villa-cross.min.css"/>
<script src="dist/js/html5shiv.js"></script>
<script src="dist/js/html5shiv-printshiv.js"></script>
<script src="dist/js/classList.min.js"></script>
<![endif]-->

<style>

	pre {
		max-width: 1000px;
		margin: 0 auto;
		word-wrap: break-word;
	}

	.Gallery-list {
		-webkit-align-items: center;
		align-items: center;
		display: -webkit-box;
		display: -moz-box;
		display: -ms-flexbox;
		display: -webkit-flex;
		display: flex;
		-webkit-justify-content: center;
		justify-content: center;
		-webkit-flex-flow: row wrap;
		flex-flow: row wrap;
		margin: 0 auto;
	}

	@media (min-width: 48em) {

		.Gallery-list {
			width: 90%;
		}

	}

	.Album {
		height: auto;
		/*margin: .5em;*/
		max-width: 150px;
		/*min-height: 200px;*/
		padding: .5em;
		position: relative;
		text-align: center;
		width: 175px;
	}

	@media (min-width: 48em) {

		.Album {
			height: 210px;
			margin: .75em;
			max-width: 175px;
			width: 175px;
		}

	}

	.AlbumCover {
		background-color: #EEEEEE;
		color: #212121;
		border: 2px solid #0277bd;
		height: 100%;
		/*padding: 1.5em 1em;*/
		position: relative;
		width: 100%;

		-moz-user-select: none;
		-ms-user-select: none;
		-khtml-user-select: none;
		-webkit-user-select: none;
		-webkit-touch-callout: none;
	}

	.AlbumCover.is-disabled {
		background-color: #E0E0E0;
		border-color: #bdbdbd;
		color: #9E9E9E;
	}

	.AlbumCover:hover {
		cursor: pointer;
	}

	.AlbumBody {
		-webkit-align-items: center;
		align-items: center;
		display: -webkit-box;
		display: -moz-box;
		display: -ms-flexbox;
		display: -webkit-flex;
		display: flex;
		-webkit-justify-content: space-between;
		justify-content: space-between;
		-webkit-flex-flow: column;
		flex-flow: column;
		padding: 1.5em 1em; /* user should click on album body to toggle disabled */

		position: relative;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
	}

	.Album-link {
		background-color: #0277bd;
		border-radius: .25em;
		color: #fff;
		font-size: .875em;
		height: 1.5em;
		line-height: 1.5em;
		position: absolute;
		right: 0;
		top: 0;
		text-align: center;
		width: 1.5em;
		z-index: 5;
	}

	/*.AlbumCover.is-disabled .Album-link {*/
	/*background-color: #bdbdbd;*/
	/*}*/

	.Album-image {
		margin-bottom: .5em;
	}

	.Album-caption {
		font-size: .875em;
		font-weight: 800;
		text-transform: uppercase;
	}

</style>

<style>

	.Gallery {
		padding: 3em 0 2.5em;
		text-align: center;
	}

</style>

<style>

	.PlaceholderExternal {
		border-radius: 2px;
		background-color: rgba(0, 0, 0, .2);
		width: 600px;
		margin: 1em 0;
		padding: 1em 1em;
	}

</style>

<style>

	.loader {
		height: 5px;
		width: 100%;
		position: relative;
		overflow: hidden;
		background-color: #ddd;
	}

	.loader:before {
		display: block;
		position: absolute;
		content: "";
		left: -200px;
		width: 1px;
		height: 5px;
		background-color: #6e3118;
		animation: loading 2s linear infinite;
	}

	@keyframes loading {
		from {
			left: -200px;
			width: 10%;
		}
		30% {
			width: 20%;
		}
		50% {
			width: 30%;
		}
		70% {
			width: 70%;
		}
		80% {
			left: 50%;
			width: 100%;
		}
		95% {
			left: 120%;
		}
		to {
			left: 100%;
		}
	}

</style>

<body class="roboto marrom-poeira--lighter">

<section class="Gallery">

	<!-- TODO: style album cover (limit to last 3 and 4th as link to gallery page -->
	<h1 class="title rye f-vermelho-terra--darkest">Galeria de fotos</h1>
	<div id="gallery-list" class="Gallery Gallery-list">

		<!--<div class="PlaceholderExternal">-->
			<!--<p>Carregando Ã¡lbums...</p>-->
			<!--<div class="loader"></div>-->
		<!--</div>-->

		<style>

			.Teste {
				width: 300px;
				height: 300px;
				border: 2px solid red;
				position: relative;
				background-repeat: no-repeat;
				background-position: center center;
				-webkit-background-size: cover;
				-moz-background-size: cover;
				-o-background-size: cover;
				background-size: cover;

				-webkit-transition: all .4s ease;
				-moz-transition: all .4s ease;
				-ms-transition: all .4s ease;
				-o-transition: all .4s ease;
				transition: all .4s ease;

				-webkit-align-items: center;
				align-items: center;
				display: -webkit-box;
				display: -moz-box;
				display: -ms-flexbox;
				display: -webkit-flex;
				display: flex;
				-webkit-justify-content: center;
				justify-content: center;
				-webkit-flex-flow: column;
				flex-flow: column;
			}

			.Teste:hover {
				border-color: green;
			}

			.Teste:hover:after {
				bottom: -.75em;
				right: -.75em;
				background-color: darkgreen;
			}

			.Teste:after {
				content: '';
				background-color: darkred;
				position: absolute;
				z-index: -1;
				bottom: -.5em;
				right: -.5em;
				display: block;
				width: 100%;
				height: 100%;

				-webkit-transition: all .4s ease;
				-moz-transition: all .4s ease;
				-ms-transition: all .4s ease;
				-o-transition: all .4s ease;
				transition: all .4s ease;
			}

			.Teste:hover h1 {
				/*padding: .575em .75em;*/
				background-color: rgba(0,0,0,.8);
				/*font-size: 1.5em;*/
				border-color: green;
			}

			.Teste h1 {
				font-size: 1.25em;
				padding: .5em;
				background-color: rgba(0,0,0,.7);
				border: 2px solid red;
				-webkit-transition: all .3s ease;
				-moz-transition: all .3s ease;
				-ms-transition: all .3s ease;
				-o-transition: all .3s ease;
				transition: all .3s ease;
			}

		</style>

		<div class="Teste" style="background-image: url('https://scontent.xx.fbcdn.net/v/t31.0-0/p600x600/20368996_1929509733975510_6919608120889740573_o.jpg?oh=015be32f605fd90145511454d4fd9c52&oe=5A024C8A');">
			<h1>05/05/2017</h1>
			<!--<h4>SEXTA-FEIRA</h4>-->
		</div>

	</div>

</section>

<script>

	window.addEventListener('load', function () {

		galleryInit();

	});

</script>

<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"></script>

<script>

	var config = {
		apiKey: "AIzaSyAMTCtuJ2DyPiBx5qBHeDg_OU1KW4UzURY",
		authDomain: "jessejamespub-com-br.firebaseapp.com",
		databaseURL: "https://jessejamespub-com-br.firebaseio.com",
		projectId: "jessejamespub-com-br",
		storageBucket: "jessejamespub-com-br.appspot.com",
		messagingSenderId: "118227352953"
	};

	firebase.initializeApp(config);

	var databaseRef = firebase.database().ref('/');
	var houseRef = databaseRef.child('assis');
	var scheduleRef = houseRef.child('schedule');
	var eventsRef = scheduleRef.child('items');

	var galleryRef = houseRef.child('gallery');
	var enabledRef = galleryRef.child('enabledAlbums');
	var disabledRef = galleryRef.child('disabledAlbums');

</script>

<script src="dist/js/axios.min.js"></script>

<script>

	var batched_albums = [];
	var batch_list = [];

	function galleryInit() {

		enabledRef.orderByKey().limitToLast(3).once('value', function (snapshot) {

			snapshot.forEach(function (child) {

				batch_list.push({
					"method": "GET",
					"relative_url": child.key + "?fields=name, link, type, cover_photo.fields(id, height, width, picture, images)"
				});

			});

			batchRequestAlbums(batch_list);

		});

	}

	function batchRequestAlbums(batch_list) {

		axios.post('https://graph.facebook.com/v2.10/', {
			access_token: '146544439255115|3_8Ip3wrGqx-BfnrEVVRhJeUpLA',
			batch: batch_list,
			include_headers: "false"
		}).then(function (response) {

			batched_albums = response.data;

//			transformDataArrayIntoAlbumsElements(batched_albums);

//            document.getElementById('gallery-list').innerHTML = '<pre><code>' + JSON.stringify(response.data, undefined, 2) +'</code></pre>';

		}).catch(function (err) {

			document.getElementById('gallery-list').innerHTML = '<span style="color: red;">' + err.message + '</span>';

		});

	}

	function transformDataArrayIntoAlbumsElements(received_albums) {

		var galleryNode = document.getElementById('gallery-list');
		galleryNode.innerHTML = '';

		for (var i = received_albums.length; i--;) {

			var album = JSON.parse(received_albums[i].body);

			var albumNode = document.createElement('div');
			albumNode.className = 'Album';

			var albumLinkNode = document.createElement('a');
			albumLinkNode.className = 'Album-link';
			albumLinkNode.href = album.link;
			albumLinkNode.target = '_blank';
			albumLinkNode.innerHTML = '<span class="icon-link-ext"></span>';

			var albumCoverNode = document.createElement('div');
			albumCoverNode.className = 'AlbumCover';
			albumCoverNode.dataset.id = album.id;

			var albumBodyNode = document.createElement('div');
			albumBodyNode.className = 'AlbumBody';

			var albumImgNode = document.createElement('img');
			albumImgNode.className = 'Album-image';
			albumImgNode.src = album.cover_photo.picture;
			console.log(album.cover_photo.images);

			if (album.cover_photo.height > album.cover_photo.width) {
				albumImgNode.src = 'http://lorempixel.com/g/130/89/abstract/retrato/';
			}

			var albumCaptionNode = document.createElement('p');
			albumCaptionNode.className = 'Album-caption';
			albumCaptionNode.textContent = album.name;

			albumBodyNode.appendChild(albumImgNode);
			albumBodyNode.appendChild(albumCaptionNode);

			albumCoverNode.appendChild(albumBodyNode);

			albumNode.appendChild(albumLinkNode);
			albumNode.appendChild(albumCoverNode);

			galleryNode.appendChild(albumNode);

		}

//		addFirebaseListeners();

	}

</script>

</body>

</html>