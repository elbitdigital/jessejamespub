<!DOCTYPE html>
<html lang="pt-br" class="roboto">
<meta charset="UTF-8">
<title>Administração - Jesse James Pub</title>
<meta name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<!--<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">-->
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#4c2f0f">
<meta name="apple-mobile-web-app-title" content="Jesse James Pub">
<meta name="application-name" content="Jesse James Pub">
<meta name="theme-color" content="#ebc373">

<script src="/dist/js/villa.min.js"></script>
<link rel="stylesheet" href="/dist/css/villa.min.css"/>
<!--[if lt IE 9]>
<link rel="stylesheet" type="text/css" href="/dist/css/material-colors.css"/>
<link rel="stylesheet" type="text/css" href="/dist/css/villa-cross.min.css"/>
<script src="/dist/js/html5shiv.js"></script>
<script src="/dist/js/html5shiv-printshiv.js"></script>
<script src="/dist/js/classList.min.js"></script>
<![endif]-->

<script src="https://www.gstatic.com/firebasejs/4.2.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.2.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.2.0/firebase-database.js"></script>
<script src="/dist/js/firebase.js"></script>

<script>

	var pub_config = {
		CITY: 'ourinhos',
		PAGE_ID: 418573041848314,
		APP_TOKEN: '1503099946449554|15VNIZhrGxhpkXDF-6CTQF1B_AE'
	};

	initApp = function () {

		firebase.auth().onAuthStateChanged(function (user) {

			var databaseRef = firebase.database().ref('/');
			var usersRef = databaseRef.child('users');
			var houseRef = databaseRef.child(pub_config.CITY);
			var adminsRef = houseRef.child('admins');

			if (user) {

				usersRef.child(user.uid).once('value').then(function (snapshot) {

					if (snapshot.exists()) {

						var uid = snapshot.child('uid').val();

						adminsRef.child(uid).once('value').then(function (snapshot) {

							if (snapshot.exists()) {
								document.getElementById('userInfo-name').textContent = user.displayName;
								document.getElementById('userInfo-email').textContent = user.email;
								document.getElementById('userInfo-uid').textContent = user.uid;
								var userStatus = document.getElementById('userOffline');
								userStatus.textContent = 'Online';
								userStatus.classList.add('Button--success');
								document.querySelectorAll('div.AdminHeader-control')[0].classList.add('is-online');
							}

						}).catch(function (err) {

							console.log('Você não tem permissão de administrador: ' + err);

							setTimeout(function() {
								window.location.href = '/' + pub_config.CITY + '/admin/logout';
							}, 3000);

						});

					} else {

						window.location.href = '/' + pub_config.CITY + '/admin/logout';

					}

				}).catch(function (err) {

					console.log('Algo de errado não está certo: ' + err);
					window.location.href = '/' + pub_config.CITY + '/admin/logout';

				});

			} else {

//				document.getElementById('account-details').textContent = 'null';

			}

		}, function (error) {

			console.log(error);

		});
	};

	window.addEventListener('load', function () {
		initApp()
	});

	if (typeof localStorage["firebaseui::rememberedAccounts"] == "undefined") {
		window.location.href = "/" + pub_config.CITY + "/admin/login";
	}

</script>

<style>

	body {
		display: -webkit-box;
		display: -moz-box;
		display: -ms-flexbox;
		display: -webkit-flex;
		display: flex;
		-webkit-flex-flow: column;
		flex-flow: column;
	}

	.logo {
		height: 100px;
		width: auto;
		margin: 1em;
	}

	.AdminHeader-info {
		-webkit-align-items: center;
		align-items: center;
		display: -webkit-box;
		display: -moz-box;
		display: -ms-flexbox;
		display: -webkit-flex;
		display: flex;
		-webkit-justify-content: center;
		justify-content: center;
		-webkit-flex-flow: column;
		flex-flow: column;
	}

	.AdminHeader-logo {
		text-align: center;
	}

	.AdminHeader-control {
		margin: 1em;
	}

	.Button--narrow {
		background-color: #03a9f4;
		border: none;
		border-radius: 2px;
		color: #ffffff;
		font-weight: 700;
		padding: .25em .5em;
		-webkit-transition: background .3s ease-in-out;
		-moz-transition: background .3s ease-in-out;
		-ms-transition: background .3s ease-in-out;
		-o-transition: background .3s ease-in-out;
		transition: background .3s ease-in-out;
		text-transform: uppercase;
	}

	.Button--narrow:focus,
	.Button--narrow:hover {
		background-color: #81d4fa;
		cursor: pointer;
		-webkit-transition: background .3s ease-in-out;
		-moz-transition: background .3s ease-in-out;
		-ms-transition: background .3s ease-in-out;
		-o-transition: background .3s ease-in-out;
		transition: background .3s ease-in-out;
	}

	.Button--narrow:active {
		background-color: #039be5;
	}

	.Button--simple {
		background-color: #585858;
	}

	.Button--simple:focus,
	.Button--simple:hover {
		background-color: #bdbdbd;
	}

	.Button--simple:active {
		background-color: #585858;
	}

	.Button--alert {
		background-color: #F44336;
	}

	.Button--alert:focus,
	.Button--alert:hover {
		background-color: #EF9A9A;
	}

	.Button--alert:active {
		background-color: #E53935;
	}

	.Button--success {
		background-color: #43A047;
	}

	.Button--success:focus,
	.Button--success:hover {
		background-color: #A5D6A7;
	}

	.Button--success:active {
		background-color: #43A047;
	}

</style>

<body class="grey-100">

<header class="AdminHeader">

	<div class="AdminHeader-background"></div>

	<div class="AdminHeader-inner font-brown-900">

		<div class="AdminHeader-logo">

			<img class="logo" src="/dist/img/svg/logo-ourinhos.svg" alt="JJPO_LOGO">

		</div>

		<div class="AdminHeader-info">

			<span style="margin-bottom: .25em;"><b>DADOS DE ACESSO</b></span>
			<span id="userInfo-name">Nome de exibição</span>
			<span id="userInfo-email">Email</span>
			<span id="userInfo-uid">Código de autenticação</span>

			<div class="AdminHeader-control">

				<a id="userLogout" href="/ourinhos/admin/logout" class="Button--narrow Button--alert">Sair</a>
				<span id="userOffline" class="Button--narrow Button--simple">Offline</span>

			</div>

		</div>

	</div>

</header>

</body>

</html>